<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Random Groove Trainer</title>
 <style>
  body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    margin: 18px;
    max-width: 900px;
  }

  h1 { margin-bottom: 4px; }

  label {
    display: block;
    margin-top: 10px;
    font-weight: 600;
  }

  input, textarea, select {
    font-size: 1rem;
    padding: 6px;
    margin-top: 6px;
    box-sizing: border-box;
  }

  /* Compact sizing for numeric and dropdown inputs */
  input[type="number"] {
    width: 90px;
  }

  select {
    width: 110px;
  }

  #sessionMode {
    width: 100%;
    max-width: 260px;
    }

  textarea {
    width: 100%;
  }

  .row {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: center;
  }

  .col {
    flex: 1;
    min-width: 200px;
  }

  button {
    padding: 10px 14px;
    margin-top: 10px;
    font-size: 1rem;
  }

  .big {
    font-size: 1.4rem;
    font-weight: 700;
    margin-top: 12px;
  }

  .status {
    margin-top: 12px;
    padding: 12px;
    background: #f3f3f3;
    border-radius: 8px;
  }

  .controls {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .small {
    font-size: 0.92rem;
  }
</style>
</head>
<body>
  <h1>Random Groove Trainer</h1>
  <p class="small">
    Randomize BPM (multiples of 5) + groove name and practice landing grooves instantly. Built-in metronome uses WebAudio for accuracy.
  </p>

  <label>BPM range (min / max)</label>
  <div class="row">
    <div class="col">
      <input id="bpmMin" type="number" inputmode="numeric" min="5" max="500" value="30" step="5">
    </div>
    <div class="col">
      <input id="bpmMax" type="number" inputmode="numeric" min="5" max="500" value="60" step="5">
    </div>
  </div>

  <label>Groove names (one per line)</label>
  <textarea id="grooves" rows="10" placeholder="e.g. Rock \n Funk \n Ÿàÿßÿ≠ÿØÿ© ŸàŸÜÿµ \n ŸÖŸÇÿ≥ŸàŸÖ \n Ÿàÿ≠ÿØÿ© ŸÉÿ®Ÿäÿ±ÿ© \n ŸÖŸÑŸÅŸàŸÅ"
  >Rock
Funk
Ÿàÿßÿ≠ÿØÿ© ŸàŸÜÿµ
ŸÖŸÇÿ≥ŸàŸÖ
Ÿàÿ≠ÿØÿ© ŸÉÿ®Ÿäÿ±ÿ©
ŸÖŸÑŸÅŸàŸÅ
  </textarea>

  <div class="row">
    <div class="col">
      <label>Time per cycle</label>
      <div class="row" style="gap:6px;">
        <input id="cycleDuration" type="number" inputmode="numeric" min="1" value="60" step="1">
        <select id="cycleUnit">
          <option value="seconds" selected>Seconds</option>
          <option value="minutes">Minutes</option>
        </select>
      </div>
    </div>

    <div class="col">
      <label>Session limit (choose one)</label>
      <select id="sessionMode">
        <option value="infinite">Run until Stop</option>
        <option value="cycles">Total cycles (set below)</option>
        <option value="time">Total session time</option>
      </select>
    </div>
  </div>

  <div class="row" style="margin-top:8px;">
    <div class="col">
      <label id="cyclesLabel">Total cycles</label>
      <input id="totalCycles" type="number" inputmode="numeric" min="1" value="5" step="1">
    </div>

    <div class="col">
      <label id="totalTimeLabel">Total session time</label>
      <div class="row" style="gap:6px;">
        <input id="totalTime" type="number" inputmode="numeric" min="1" value="300" step="1">
        <select id="totalTimeUnit">
          <option value="seconds" selected>Seconds</option>
          <option value="minutes">Minutes</option>
          <option value="hours">Hours</option>
        </select>
      </div>
    </div>
  </div>

  <div class="controls">
    <button id="startBtn">Start</button>
    <button id="pauseBtn" disabled>Pause</button>
    <button id="nextBtn" disabled>Next</button>
    <button id="stopBtn" disabled>Stop</button>
  </div>

  <div class="status" aria-live="polite">
    <div class="big" id="displayBpm">BPM: ‚Äî</div>
    <div class="big" id="displayGroove">Groove: ‚Äî</div>
    <div style="margin-top:8px">Cycle remaining time: <span id="countdown">‚Äî</span> s</div>
    <div style="margin-top:6px">Cycles done: <span id="cyclesDone">0</span></div>
  </div>

  <!-- JS -->
  <script type="module">
    import { startMetronome, stopMetronome } from './js/metronome.js';
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const nextBtn = document.getElementById('nextBtn');
    const bpmMinEl = document.getElementById('bpmMin');
    const bpmMaxEl = document.getElementById('bpmMax');
    const groovesEl = document.getElementById('grooves');
    const displayBpm = document.getElementById('displayBpm');
    const displayGroove = document.getElementById('displayGroove');
    const countdownEl = document.getElementById('countdown');
    const cyclesDoneEl = document.getElementById('cyclesDone');
    const sessionModeEl = document.getElementById('sessionMode');
    const totalCyclesEl = document.getElementById('totalCycles');
    const totalTimeEl = document.getElementById('totalTime');
    const totalTimeUnitEl = document.getElementById('totalTimeUnit');
    const cycleDurationEl = document.getElementById('cycleDuration');
    const cycleUnitEl = document.getElementById('cycleUnit');

    let activeTimer = null;
    let sessionTimer = null;
    let cyclesDone = 0;
    let isRunning = false;

    function randomizeGroove() {
      const grooves = groovesEl.value.split('\n').map(g => g.trim()).filter(Boolean);
      const bpmMin = parseInt(bpmMinEl.value);
      const bpmMax = parseInt(bpmMaxEl.value);
      const randomBpm = Math.floor((Math.random() * (bpmMax - bpmMin + 5)) / 5) * 5 + bpmMin;
      const randomGroove = grooves[Math.floor(Math.random() * grooves.length)];
      return { bpm: randomBpm, groove: randomGroove };
    }

    function runCycle() {
      const { bpm, groove } = randomizeGroove();
      displayBpm.textContent = `BPM: ${bpm}`;
      displayGroove.textContent = `Groove: ${groove}`;
      cyclesDoneEl.textContent = ++cyclesDone;
      startMetronome(bpm);

      const durationValue = parseInt(cycleDurationEl.value);
      const durationUnit = cycleUnitEl.value;
      let remaining = durationUnit === 'minutes' ? durationValue * 60 : durationValue;

      countdownEl.textContent = remaining;
      clearInterval(activeTimer);

      activeTimer = setInterval(() => {
        remaining--;
        countdownEl.textContent = remaining;
        if (remaining <= 0) {
          clearInterval(activeTimer);
          stopMetronome();

          const mode = sessionModeEl.value;
          if (mode === 'cycles' && cyclesDone >= parseInt(totalCyclesEl.value)) {
            stopSession('‚úÖ Session complete (cycles limit reached)');
          } else {
            runCycle();
          }
        }
      }, 1000);
    }

    function stopSession(message) {
      isRunning = false;
      stopMetronome();
      clearInterval(activeTimer);
      clearTimeout(sessionTimer);
      startBtn.disabled = false;
      stopBtn.disabled = true;
      nextBtn.disabled = true;
      console.log(message || 'Session stopped');
    }

    startBtn.onclick = () => {
      if (isRunning) return;
      isRunning = true;
      cyclesDone = 0;
      runCycle();

      startBtn.disabled = true;
      stopBtn.disabled = false;
      nextBtn.disabled = false;

      const mode = sessionModeEl.value;
      if (mode === 'time') {
        const totalValue = parseInt(totalTimeEl.value);
        const totalUnit = totalTimeUnitEl.value;
        let totalSeconds = totalValue;
        if (totalUnit === 'minutes') totalSeconds *= 60;
        else if (totalUnit === 'hours') totalSeconds *= 3600;

        sessionTimer = setTimeout(() => {
          stopSession('‚úÖ Session complete (time limit reached)');
        }, totalSeconds * 1000);
      }
    };

    stopBtn.onclick = () => stopSession('üõë Stopped by user');

    nextBtn.onclick = () => {
      if (!isRunning) return;
      stopMetronome();
      clearInterval(activeTimer);
      runCycle();
    };
  </script>
</body>
</html>